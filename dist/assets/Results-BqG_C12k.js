import{j as e,a as I,b as H,r as b,c as P,g as D,Q as C,B as f,L as M}from"./index-DPgD9II7.js";import{C as p,a as v,b as N,c as w}from"./Card-Befwowg9.js";function A({title:t,bars:r,max:n=100}){const i=Math.max(...r.map(a=>Math.abs(a.value))),m=i>0?Math.max(i,n*.1):n;return e.jsxs("div",{children:[t&&e.jsx("h3",{className:"mb-4 text-sm font-medium text-gray-700 dark:text-gray-300",children:t}),e.jsx("div",{className:"space-y-3",children:r.map((a,h)=>{const o=Math.min(100,Math.max(2,Math.round(Math.abs(a.value)/m*100))),c=a.value>=0;return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-1 pr-2",children:a.label.replace(/^\d+\.\s*/,"")}),e.jsxs("span",{className:`font-bold tabular-nums ${c?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[c?"+":"",a.value.toFixed(2)]})]}),e.jsx("div",{className:"h-4 w-full rounded-full bg-gray-100 dark:bg-gray-800 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${o}%`,backgroundColor:a.color||(c?"#16a34a":"#dc2626"),boxShadow:"inset 0 1px 2px rgba(0,0,0,0.1)"},role:"img","aria-label":`${a.label}: ${a.value.toFixed(2)}`,children:e.jsx("div",{className:"h-full w-full bg-gradient-to-r from-transparent to-white/20"})})})]},`${a.label}-${h}`)})}),r.length===0&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx("div",{className:"text-2xl mb-2",children:"📊"}),e.jsx("p",{className:"text-sm",children:"データがありません"})]})]})}const k=new TextEncoder,U=()=>"dev-insecure-secret",R=async t=>crypto.subtle.importKey("raw",k.encode(t),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]),y={encode:t=>btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),decode:t=>Uint8Array.from(atob(t.replace(/-/g,"+").replace(/_/g,"/")),r=>r.charCodeAt(0))},L=t=>{const r=t.map(n=>[n.questionId,n.value]);return JSON.stringify(r)},_=t=>JSON.parse(t).map(([n,i])=>({questionId:n,value:i})),B=async(t,r)=>{const n=Date.now().toString(),i=`${L(r)}|${n}`,m=await R(U()),a=await crypto.subtle.sign("HMAC",m,k.encode(i)),h=y.encode(new Uint8Array(a)),o=y.encode(k.encode(L(r))),c=new URL(t);return c.searchParams.set("data",o),c.searchParams.set("ts",n),c.searchParams.set("sig",h),c.toString()},J=async(t,r,n)=>{try{if(!t||!r||!n)return{valid:!1,error:"パラメータが不足しています。"};const i=1e3*60*60*24,m=Date.now(),a=Number(r);if(!Number.isFinite(a))return{valid:!1,error:"タイムスタンプが不正です。"};if(m-a>i)return{valid:!1,error:"共有URLの有効期限が切れています。"};const h=new TextDecoder().decode(y.decode(t)),o=_(h),c=`${h}|${r}`,S=await R(U());return await crypto.subtle.verify("HMAC",S,y.decode(n),k.encode(c))?{valid:!0,answers:o}:{valid:!1,error:"署名の検証に失敗しました。"}}catch{return{valid:!1,error:"共有URLの解析に失敗しました。"}}};function Q(){const{state:t,loadAnswers:r,reset:n}=I(),i=H(),m=new URLSearchParams(i.search),[a,h]=b.useState(null),[o,c]=b.useState(null),[S,$]=b.useState(!1);b.useEffect(()=>{const s=m.get("data"),d=m.get("ts"),x=m.get("sig");s&&d&&x&&J(s,d,x).then(l=>{l.valid&&l.answers?(r(l.answers),$(!0)):h(l.error||"共有URLの検証に失敗しました。")})},[]);const u=b.useMemo(()=>P(t.answers),[t.answers]),g=b.useMemo(()=>D(30),[]),F=C.filter(s=>s.weight>0).map(s=>{var d;return{label:`${s.id}. ${s.text}`,value:(((d=t.answers.find(x=>x.questionId===s.id))==null?void 0:d.value)||0)*s.weight,color:"#16a34a"}}),T=C.filter(s=>s.weight<0).map(s=>{var d;return{label:`${s.id}. ${s.text}`,value:Math.abs((((d=t.answers.find(x=>x.questionId===s.id))==null?void 0:d.value)||0)*s.weight),color:"#dc2626"}}),E=async()=>{try{const s=await B(window.location.origin+"/results",t.answers);c(s)}catch{h("共有リンクの生成に失敗しました。")}};return e.jsx("main",{className:"container py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("header",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"診断結果"}),a&&e.jsx("div",{className:"mt-4 p-4 rounded-lg bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",role:"alert",children:a})})]}),e.jsx(e.Fragment,{children:e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-lg text-gray-700 dark:text-gray-300 mb-4",children:"あなたのToMo指数は..."}),e.jsxs("div",{className:"text-6xl font-bold text-orange-500 mb-2",children:[u.totalScore.toFixed(2),e.jsx("span",{className:"text-3xl",children:"点"}),"です"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"点数は-100点から+100点の範囲となります。"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:u.commentary})]}),g.count>0&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-blue-900/50 dark:to-indigo-900/50 p-6 shadow-sm border border-slate-200/50 dark:border-slate-700/50",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-400/10 to-indigo-400/10 rounded-full -translate-y-16 translate-x-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-purple-400/10 to-pink-400/10 rounded-full translate-y-12 -translate-x-12"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-full px-4 py-2 shadow-sm",children:e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"📊 診断統計データ"})})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-1",children:u.totalScore.toFixed(2)}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"あなたのスコア"})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400 mb-1",children:g.average}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"平均スコア"})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-violet-600 dark:text-violet-400 mb-1",children:g.median}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"中央値"})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-sky-600 dark:text-sky-400 mb-1",children:g.count}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"総回答者数"})]})})]}),e.jsxs("div",{className:"mt-6 text-center space-y-3",children:[e.jsx("div",{className:"inline-flex items-center bg-white/60 dark:bg-slate-800/60 backdrop-blur-sm rounded-full px-6 py-3 shadow-sm",children:e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:["あなたは平均より",u.totalScore>g.average?e.jsxs("span",{className:"ml-1 inline-flex items-center text-emerald-600 dark:text-emerald-400 font-semibold",children:[e.jsx("span",{className:"mr-1",children:"📈"}),(u.totalScore-g.average).toFixed(1),"点高い"]}):u.totalScore===g.average?e.jsxs("span",{className:"ml-1 inline-flex items-center text-slate-600 dark:text-slate-400 font-semibold",children:[e.jsx("span",{className:"mr-1",children:"⚖️"}),"同じ"]}):e.jsxs("span",{className:"ml-1 inline-flex items-center text-amber-600 dark:text-amber-400 font-semibold",children:[e.jsx("span",{className:"mr-1",children:"📉"}),(g.average-u.totalScore).toFixed(1),"点低い"]})]})}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"※ただし、デフォルトの選択肢で回答している点数が0点の人を除く"})]})]})]})})]})}),e.jsxs("section",{className:"mb-8 grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"📈"}),"ポジティブ要因の寄与"]})}),e.jsx(w,{children:e.jsx(A,{bars:F,max:100})})]}),e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"📉"}),"ネガティブ要因の寄与"]})}),e.jsx(w,{children:e.jsx(A,{bars:T,max:100})})]})]}),e.jsxs(p,{className:"mb-8",children:[e.jsx(v,{children:e.jsx(N,{className:"text-center text-xl",children:"あなたの回答"})}),e.jsxs(w,{children:[e.jsx("div",{className:"space-y-8",children:C.map(s=>{const d=t.answers.find(l=>l.questionId===s.id),x=(d==null?void 0:d.value)||4;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("span",{className:"text-slate-600 dark:text-slate-400 font-medium text-lg mt-1",children:[s.id,"."]}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-slate-700 dark:text-slate-300 leading-relaxed",children:s.text.split("は").map((l,j)=>j===1?e.jsxs("span",{className:"text-orange-500 font-medium",children:["は",l]},j):l+(j===0?"は":""))})})]}),e.jsxs("div",{className:"ml-8",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 mb-3 font-medium",children:[e.jsx("span",{children:"全く違う"}),e.jsx("span",{children:"全くそのとおりである"})]}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:Array.from({length:7},(l,j)=>j+1).map(l=>e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${x===l?"bg-blue-500 border-blue-500 shadow-lg ring-4 ring-blue-200 dark:ring-blue-800":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 hover:border-blue-400"}`,children:x===l&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-white"})}),e.jsx("span",{className:`text-sm font-medium transition-colors ${x===l?"text-blue-600 dark:text-blue-400":"text-slate-400 dark:text-slate-500"}`,children:l})]},l))})]})]},s.id)})}),e.jsx("div",{className:"mt-8 p-4 bg-slate-100/70 dark:bg-slate-700/50 rounded-lg border border-slate-200/50 dark:border-slate-600/50",children:e.jsx("div",{className:"text-center text-sm text-slate-600 dark:text-slate-400",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"回答スケール: 1 (全く違う) 〜 7 (全くそのとおりである)"]})})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[!S&&!0&&e.jsxs(f,{onClick:E,className:"flex items-center gap-2",children:[e.jsx("span",{children:"🔗"}),"結果を共有"]}),e.jsx(M,{to:"/diagnostic",children:e.jsxs(f,{variant:"secondary",onClick:()=>n(),className:"flex items-center gap-2",children:[e.jsx("span",{children:"🔄"}),"再診断"]})}),e.jsx(M,{to:"/",children:e.jsxs(f,{variant:"ghost",className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏠"}),"ホームに戻る"]})})]}),e.jsxs("div",{className:"text-center mt-8",children:[e.jsx("div",{className:"mb-4 text-gray-700 dark:text-gray-300 font-medium",children:"結果をシェアする"}),e.jsx("button",{onClick:()=>{const d=`https://twitter.com/intent/tweet?text=${`あなたのToMo指数は${u.totalScore.toFixed(2)}点です。点数は-100点から+100点の範囲となります。%0A%0A#ToMo指数診断`}&url=${encodeURIComponent(window.location.href)}`;window.open(d,"_blank","noopener,noreferrer")},className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-110","aria-label":"Twitterでシェア",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"})})})]}),o&&!0&&e.jsxs(p,{className:"mt-8",children:[e.jsx(v,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🔗"}),"共有用URL"]})}),e.jsx(w,{children:e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"break-words text-blue-700 dark:text-blue-400 font-mono text-sm mb-3",children:e.jsx("a",{href:o,className:"hover:underline",children:o})}),e.jsx("div",{className:"flex gap-2",children:e.jsx(f,{variant:"secondary",onClick:()=>navigator.clipboard.writeText(o),className:"text-xs",children:"URLをコピー"})}),e.jsx("p",{className:"mt-3 text-xs text-gray-600 dark:text-gray-400",children:"⚠️ 注意: クライアントサイド実装のため完全な改ざん防止ではありません。"})]})})]})]})})}export{Q as default};
