import{r,j as e,B as o,g as k}from"./index-ByMMeb6h.js";import{C as i,a as x,b as m,c as h}from"./Card-ZyA1TYYO.js";const S="tomo_responses",j=()=>{try{const s=localStorage.getItem(S);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading responses:",s),[]}},E=()=>{const s=j();return JSON.stringify({exportDate:new Date().toISOString(),totalRecords:s.length,data:s},null,2)},D=()=>{localStorage.removeItem(S)};function F(){const[s,f]=r.useState(j()),[a,g]=r.useState({count:0,average:0,median:0,min:0,max:0,totalCount:0}),[l,c]=r.useState("loading"),[u,p]=r.useState(null),[b,v]=r.useState(0),d=async()=>{f(j()),c("loading"),p(null);try{const t=await k(30);g(t),v(t.totalCount||0),c("server")}catch(t){console.error("Failed to load statistics from server:",t),g({count:0,average:0,median:0,min:0,max:0,totalCount:0}),v(0),c("error"),p("サーバーから統計データを取得できませんでした。時間をおいて再度お試しください。")}};r.useEffect(()=>{d()},[]);const y=()=>{const t=E(),w=new Blob([t],{type:"application/json"}),N=URL.createObjectURL(w),n=document.createElement("a");n.href=N,n.download=`tomo-responses-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(N)},C=()=>{confirm("本当に全てのデータを削除しますか？この操作は取り消せません。")&&(D(),d())};return e.jsx("main",{className:"container py-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"管理者パネル"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"回答データの管理と統計の確認"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-8",children:[e.jsxs(i,{children:[e.jsx(x,{children:e.jsx(m,{children:"統計データ"})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:["総回答数: ",l==="server"?b:"-","件",l==="server"&&e.jsx("span",{className:"ml-2 text-xs text-green-600 dark:text-green-400",children:"● サーバーデータ"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ローカルデータ: ",s.length,"件"]}),l==="loading"&&e.jsx("div",{className:"text-sm text-gray-500",children:"統計データを読み込み中です..."}),l==="error"&&u&&e.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-600 dark:border-red-800 dark:bg-red-900/30 dark:text-red-300",children:u}),l==="server"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["有効回答数: ",a.count,"件（0点除く）"]}),e.jsxs("div",{children:["直近30件の平均: ",a.average,"点"]}),e.jsxs("div",{children:["直近30件の中央値: ",a.median,"点"]}),e.jsxs("div",{children:["最低点: ",a.min,"点"]}),e.jsxs("div",{children:["最高点: ",a.max,"点"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"※統計値は0点（デフォルト回答）を除外して計算"})]})]})})]}),e.jsxs(i,{children:[e.jsx(x,{children:e.jsx(m,{children:"データ管理"})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{onClick:d,className:"w-full",children:"データを更新"}),e.jsx(o,{onClick:y,variant:"secondary",className:"w-full",children:"データをエクスポート"}),e.jsx(o,{onClick:C,variant:"danger",className:"w-full",children:"全データを削除"})]})})]})]}),e.jsxs(i,{children:[e.jsx(x,{children:e.jsx(m,{children:"最近の回答履歴"})}),e.jsx(h,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"ID"}),e.jsx("th",{className:"text-left p-2",children:"日時"}),e.jsx("th",{className:"text-left p-2",children:"総合スコア"}),e.jsx("th",{className:"text-left p-2",children:"ポジティブ"}),e.jsx("th",{className:"text-left p-2",children:"ネガティブ"})]})}),e.jsx("tbody",{children:s.slice(0,50).map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsxs("td",{className:"p-2 font-mono text-xs",children:[t.id.substring(0,8),"..."]}),e.jsx("td",{className:"p-2",children:new Date(t.timestamp).toLocaleString("ja-JP")}),e.jsx("td",{className:"p-2 font-bold",children:t.totalScore.toFixed(2)}),e.jsxs("td",{className:"p-2 text-green-600",children:["+",t.positiveScore.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-red-600",children:["-",t.negativeScore.toFixed(2)]})]},t.id))})]}),s.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"まだ回答データがありません"})]})})]})]})})}export{F as default};
